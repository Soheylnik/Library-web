{% extends 'parent/base.html' %}
{% load static %}

{% block title %}ÙØ±ÙˆØ´Ú¯Ø§Ù‡ - Ø¨ÙˆÚ©Ù†{% endblock %}

{% block head_extra %}
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
{% endblock %}

{% block content %}

      <!-- 
        - #PAGE HEADER
      -->

      <section class="section page-header" aria-label="page header">
        <div class="container">

          <h1 class="h1 page-title">ÙØ±ÙˆØ´Ú¯Ø§Ù‡</h1>

          <nav class="breadcrumb">
            <a href="{% url 'core:index' %}" class="breadcrumb-link">Ø®Ø§Ù†Ù‡</a>
            <span class="breadcrumb-separator">/</span>
            <span class="breadcrumb-current">ÙØ±ÙˆØ´Ú¯Ø§Ù‡</span>
          </nav>

        </div>
      </section>

      <!-- 
        - #SHOP SECTION
      -->

      <section class="section shop" aria-label="shop">
        <div class="container">

          <div class="shop-content">

            <!-- Sidebar -->
            <aside class="shop-sidebar">

              <div class="sidebar-card">

                <h3 class="h3 card-title">
                  <ion-icon name="list-outline"></ion-icon>
                  Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§
                </h3>

                <ul class="sidebar-list" id="categoryFilter">
                  <li>
                    <a href="?{% if search_query %}search={{ search_query }}&{% endif %}{% if min_price %}min_price={{ min_price }}&{% endif %}{% if max_price %}max_price={{ max_price }}&{% endif %}{% if sort_by %}sort={{ sort_by }}{% endif %}" 
                       class="sidebar-link{% if not genre_filter %} active{% endif %}">
                      <ion-icon name="apps-outline"></ion-icon>
                      Ù‡Ù…Ù‡ Ø¯Ø³ØªÙ‡â€ŒÙ‡Ø§
                    </a>
                  </li>
                  {% for genre in genres %}
                  <li>
                    <a href="?{% if search_query %}search={{ search_query }}&{% endif %}{% if min_price %}min_price={{ min_price }}&{% endif %}{% if max_price %}max_price={{ max_price }}&{% endif %}genre={{ genre.name }}{% if sort_by %}&sort={{ sort_by }}{% endif %}" 
                       class="sidebar-link{% if genre_filter == genre.name %} active{% endif %}">
                      <ion-icon name="book-outline"></ion-icon>
                      {{ genre.name }}
                    </a>
                  </li>
                  {% endfor %}
                </ul>

              </div>

              <div class="sidebar-card">

                <h3 class="h3 card-title">
                  <ion-icon name="cash-outline"></ion-icon>
                  Ù…Ø­Ø¯ÙˆØ¯Ù‡ Ù‚ÛŒÙ…Øª
                </h3>

                <form method="GET" id="priceFilterForm">
                  {% if search_query %}<input type="hidden" name="search" value="{{ search_query }}">{% endif %}
                  {% if genre_filter %}<input type="hidden" name="genre" value="{{ genre_filter }}">{% endif %}
                  {% if sort_by %}<input type="hidden" name="sort" value="{{ sort_by }}">{% endif %}

                <div class="price-range">
                  <div class="price-inputs">
                      <input type="number" class="price-input" placeholder="Ø­Ø¯Ø§Ù‚Ù„" name="min_price" id="minPriceInput" value="{{ min_price }}">
                    <span class="price-separator">ØªØ§</span>
                      <input type="number" class="price-input" placeholder="Ø­Ø¯Ø§Ú©Ø«Ø±" name="max_price" id="maxPriceInput" value="{{ max_price }}">
                  </div>
                    <input type="range" class="price-range-slider" min="0" max="1000000" value="{{ max_price|default:'1000000' }}" id="priceRange">
                  <div class="price-range-value">
                      <span id="minPrice">{{ min_price|default:'0' }}</span> - <span id="maxPrice">{{ max_price|default:'1,000,000' }}</span> ØªÙˆÙ…Ø§Ù†
                  </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 10px;">Ø§Ø¹Ù…Ø§Ù„ ÙÛŒÙ„ØªØ±</button>
                </div>
                </form>

              </div>

              <div class="sidebar-card">

                <h3 class="h3 card-title">
                  <ion-icon name="star-outline"></ion-icon>
                  ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§
                </h3>

                <ul class="sidebar-list">
                  <li>
                    <label class="checkbox-wrapper">
                      <input type="checkbox" class="checkbox-input" id="featuredFilter">
                      <span class="checkbox-mark"></span>
                      <span class="checkbox-label">
                        <ion-icon name="star"></ion-icon>
                        Ù…Ø­ØµÙˆÙ„Ø§Øª ÙˆÛŒÚ˜Ù‡
                      </span>
                    </label>
                  </li>
                  <li>
                    <label class="checkbox-wrapper">
                      <input type="checkbox" class="checkbox-input" id="newFilter">
                      <span class="checkbox-mark"></span>
                      <span class="checkbox-label">
                        <ion-icon name="sparkles"></ion-icon>
                        Ù…Ø­ØµÙˆÙ„Ø§Øª Ø¬Ø¯ÛŒØ¯
                      </span>
                    </label>
                  </li>
                  <li>
                    <label class="checkbox-wrapper">
                      <input type="checkbox" class="checkbox-input" id="discountFilter">
                      <span class="checkbox-mark"></span>
                      <span class="checkbox-label">
                        <ion-icon name="pricetag"></ion-icon>
                        ØªØ®ÙÛŒÙâ€ŒØ¯Ø§Ø±
                      </span>
                    </label>
                  </li>
                  <li>
                    <label class="checkbox-wrapper">
                      <input type="checkbox" class="checkbox-input" id="bestsellerFilter">
                      <span class="checkbox-mark"></span>
                      <span class="checkbox-label">
                        <ion-icon name="trophy"></ion-icon>
                        Ù¾Ø±ÙØ±ÙˆØ´â€ŒØªØ±ÛŒÙ†
                      </span>
                    </label>
                  </li>
                </ul>

              </div>

              <div class="sidebar-card">

                <h3 class="h3 card-title">
                  <ion-icon name="star-half-outline"></ion-icon>
                  Ø§Ù…ØªÛŒØ§Ø²
                </h3>

                <ul class="sidebar-list">
                  <li>
                    <label class="checkbox-wrapper">
                      <input type="checkbox" class="checkbox-input" id="rating5">
                      <span class="checkbox-mark"></span>
                      <span class="checkbox-label">
                        <div class="rating-stars">
                          <ion-icon name="star"></ion-icon>
                          <ion-icon name="star"></ion-icon>
                          <ion-icon name="star"></ion-icon>
                          <ion-icon name="star"></ion-icon>
                          <ion-icon name="star"></ion-icon>
                        </div>
                        <span class="rating-text">5 Ø³ØªØ§Ø±Ù‡</span>
                      </span>
                    </label>
                  </li>
                  <li>
                    <label class="checkbox-wrapper">
                      <input type="checkbox" class="checkbox-input" id="rating4">
                      <span class="checkbox-mark"></span>
                      <span class="checkbox-label">
                        <div class="rating-stars">
                          <ion-icon name="star"></ion-icon>
                          <ion-icon name="star"></ion-icon>
                          <ion-icon name="star"></ion-icon>
                          <ion-icon name="star"></ion-icon>
                          <ion-icon name="star-outline"></ion-icon>
                        </div>
                        <span class="rating-text">4 Ø³ØªØ§Ø±Ù‡ Ùˆ Ø¨Ø§Ù„Ø§ØªØ±</span>
                      </span>
                    </label>
                  </li>
                  <li>
                    <label class="checkbox-wrapper">
                      <input type="checkbox" class="checkbox-input" id="rating3">
                      <span class="checkbox-mark"></span>
                      <span class="checkbox-label">
                        <div class="rating-stars">
                          <ion-icon name="star"></ion-icon>
                          <ion-icon name="star"></ion-icon>
                          <ion-icon name="star"></ion-icon>
                          <ion-icon name="star-outline"></ion-icon>
                          <ion-icon name="star-outline"></ion-icon>
                        </div>
                        <span class="rating-text">3 Ø³ØªØ§Ø±Ù‡ Ùˆ Ø¨Ø§Ù„Ø§ØªØ±</span>
                      </span>
                    </label>
                  </li>
                </ul>

              </div>

              <div class="sidebar-actions">
                <button class="btn btn-outline" id="clearFilters">
                  <ion-icon name="refresh-outline"></ion-icon>
                  Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† ÙÛŒÙ„ØªØ±Ù‡Ø§
                </button>
              </div>

            </aside>

            <!-- Main Content -->
            <div class="shop-main">

              <!-- Toolbar -->
              <div class="shop-toolbar">

               

                <div class="toolbar-right">

                  <form method="GET" id="sortForm">
                    {% if search_query %}<input type="hidden" name="search" value="{{ search_query }}">{% endif %}
                    {% if min_price %}<input type="hidden" name="min_price" value="{{ min_price }}">{% endif %}
                    {% if max_price %}<input type="hidden" name="max_price" value="{{ max_price }}">{% endif %}
                    {% if genre_filter %}<input type="hidden" name="genre" value="{{ genre_filter }}">{% endif %}

                  <div class="sort-wrapper">
                    <label for="sortSelect" class="sort-label">Ù…Ø±ØªØ¨â€ŒØ³Ø§Ø²ÛŒ:</label>
                      <select class="sort-select" id="sortSelect" name="sort" onchange="this.form.submit()">
                        <option value="title" {% if sort_by == 'title' %}selected{% endif %}>Ù†Ø§Ù…: Ø§Ù„Ù ØªØ§ ÛŒ</option>
                        <option value="date_desc" {% if sort_by == 'date_desc' %}selected{% endif %}>Ø¬Ø¯ÛŒØ¯ØªØ±ÛŒÙ†</option>
                        <option value="date_asc" {% if sort_by == 'date_asc' %}selected{% endif %}>Ù‚Ø¯ÛŒÙ…ÛŒâ€ŒØªØ±ÛŒÙ†</option>
                        <option value="price_asc" {% if sort_by == 'price_asc' %}selected{% endif %}>Ù‚ÛŒÙ…Øª: Ú©Ù… Ø¨Ù‡ Ø²ÛŒØ§Ø¯</option>
                        <option value="price_desc" {% if sort_by == 'price_desc' %}selected{% endif %}>Ù‚ÛŒÙ…Øª: Ø²ÛŒØ§Ø¯ Ø¨Ù‡ Ú©Ù…</option>
                    </select>
                  </div>
                  </form>

                  

                </div>

              </div>

              <!-- Products Grid -->
              <div class="products-grid" id="productsGrid">
                <ul class="grid-list">
                  {% for book in books %}
                  <li>
                    <div class="product-card">
      
                      <span class="card-badge">Ø¬Ø¯ÛŒØ¯</span>
      
                      <div class="card-banner img-holder" style="--width: 384; --height: 480;">
                        {% if book.image %}
                          <img src="{{ book.image.url }}" width="384" height="480" loading="lazy" alt="{{ book.title }}"
                            class="img-cover" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                          <div style="display: none; width: 100%; height: 100%; background: linear-gradient(135deg, #f8f9fa, #e9ecef); align-items: center; justify-content: center; color: #6c757d; font-size: 14px; text-align: center; border-radius: 8px;">
                            ğŸ“š<br>Ø¨Ø¯ÙˆÙ† ØªØµÙˆÛŒØ±
                        </div>
                        {% else %}
                          <div style="width: 100%; height: 100%; background: linear-gradient(135deg, #f8f9fa, #e9ecef); display: flex; align-items: center; justify-content: center; color: #6c757d; font-size: 14px; text-align: center; border-radius: 8px;">
                            ğŸ“š<br>Ø¨Ø¯ÙˆÙ† ØªØµÙˆÛŒØ±
                      </div>
                        {% endif %}
      
                        <div class="card-action">
      
                          <button class="action-btn" aria-label="quick view" title="Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø³Ø±ÛŒØ¹">
                            <ion-icon name="eye-outline" aria-hidden="true"></ion-icon>
                          </button>
      
                          <button class="action-btn" aria-label="add to wishlist" title="Ø§ÙØ²ÙˆØ¯Ù† Ø¨Ù‡ Ø¹Ù„Ø§Ù‚Ù‡â€ŒÙ…Ù†Ø¯ÛŒâ€ŒÙ‡Ø§" onclick="toggleFavorite({{ book.id }})">
                            <ion-icon name="heart-outline" aria-hidden="true"></ion-icon>
                          </button>
      
                          <button class="action-btn" aria-label="compare" title="Ù…Ù‚Ø§ÛŒØ³Ù‡">
                            <ion-icon name="repeat-outline" aria-hidden="true"></ion-icon>
                          </button>
      
                          <button class="action-btn" aria-label="add to cart" title="Ø§ÙØ²ÙˆØ¯Ù† Ø¨Ù‡ Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯">
                            <ion-icon name="bag-handle-outline" aria-hidden="true"></ion-icon>
                          </button>
      
                        </div>
                      </div>
      
                      <div class="card-content">
      
                        <h3 class="h3">
                          <a href="#" class="card-title">{{ book.title }}</a>
                        </h3>
      
                        <data class="card-price" value="{{ book.price }}">{{ book.price }} ØªÙˆÙ…Ø§Ù†</data>
      
                        <div class="rating-wrapper">
                          <ion-icon name="star-outline" aria-hidden="true"></ion-icon>
                          <ion-icon name="star-outline" aria-hidden="true"></ion-icon>
                          <ion-icon name="star-outline" aria-hidden="true"></ion-icon>
                          <ion-icon name="star-outline" aria-hidden="true"></ion-icon>
                          <ion-icon name="star-outline" aria-hidden="true"></ion-icon>
                        </div>
      
                      </div>
      
                    </div>
                  </li>
                  {% endfor %}
      
                </ul>
                <!-- Products will be loaded here -->
              </div>

              <!-- Loading Spinner -->
              <div class="loading-spinner" id="loadingSpinner" style="display: none;">
                <div class="spinner"></div>
                <p>Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...</p>
              </div>

              <!-- No Results -->
              <div class="no-results" id="noResults" style="display: none;">
                <div class="no-results-content">
                  <ion-icon name="search-outline"></ion-icon>
                  <h3>Ù…Ø­ØµÙˆÙ„ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯</h3>
                  <p>Ù„Ø·ÙØ§Ù‹ ÙÛŒÙ„ØªØ±Ù‡Ø§ÛŒ Ø¬Ø³ØªØ¬Ùˆ Ø±Ø§ ØªØºÛŒÛŒØ± Ø¯Ù‡ÛŒØ¯</p>
                  <button class="btn btn-primary" id="resetFilters">Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ ÙÛŒÙ„ØªØ±Ù‡Ø§</button>
                </div>
              </div>

              <!-- Pagination -->
              <nav class="pagination" id="pagination">
                <!-- Pagination will be generated here -->
              </nav>

            </div>

          </div>

        </div>
      </section>

    </article>
  </main>

{% endblock %}

{% block scripts %}
  <script src="{% static 'js/shop.js' %}" defer></script>
  <script>
  function toggleFavorite(bookId) {
      fetch('{% url "accounts:toggle_favorite" %}', {
          method: 'POST',
          headers: {
              'Content-Type': 'application/json',
              'X-CSRFToken': '{{ csrf_token }}'
          },
          body: JSON.stringify({
              book_id: bookId
          })
      })
      .then(response => response.json())
      .then(data => {
          if (data.status === 'added') {
              alert('Ú©ØªØ§Ø¨ Ø¨Ù‡ Ø¹Ù„Ø§Ù‚Ù‡â€ŒÙ…Ù†Ø¯ÛŒâ€ŒÙ‡Ø§ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯');
          } else if (data.status === 'removed') {
              alert('Ú©ØªØ§Ø¨ Ø§Ø² Ø¹Ù„Ø§Ù‚Ù‡â€ŒÙ…Ù†Ø¯ÛŒâ€ŒÙ‡Ø§ Ø­Ø°Ù Ø´Ø¯');
          }
      })
      .catch(error => {
          console.error('Error:', error);
      });
  }

  // ÙÛŒÙ„ØªØ± Ù‚ÛŒÙ…Øª
  document.addEventListener('DOMContentLoaded', function() {
      const priceRange = document.getElementById('priceRange');
      const minPriceInput = document.getElementById('minPriceInput');
      const maxPriceInput = document.getElementById('maxPriceInput');
      const minPriceDisplay = document.getElementById('minPrice');
      const maxPriceDisplay = document.getElementById('maxPrice');

      if (priceRange && minPriceInput && maxPriceInput) {
          priceRange.addEventListener('input', function() {
              maxPriceInput.value = this.value;
              maxPriceDisplay.textContent = parseInt(this.value).toLocaleString();
          });

          minPriceInput.addEventListener('input', function() {
              if (parseInt(this.value) > parseInt(maxPriceInput.value)) {
                  this.value = maxPriceInput.value;
              }
              minPriceDisplay.textContent = parseInt(this.value).toLocaleString();
          });

          maxPriceInput.addEventListener('input', function() {
              if (parseInt(this.value) < parseInt(minPriceInput.value)) {
                  this.value = minPriceInput.value;
              }
              maxPriceDisplay.textContent = parseInt(this.value).toLocaleString();
          });
      }
  });
  </script>
{% endblock %}